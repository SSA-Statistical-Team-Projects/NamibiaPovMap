devtools::load_all()
devtools::load_all()
renv::restore()
devtools::load_all()
#----------------------- EBP MODEL  ESTAIMATION -------------------------------#
## environment set up
remove(list = objects()) ## clear all objects in R workspace
options(
stringsAsFactors = F, ## tell R to treat text as text, not factors
width = 100, ## set the maximum width of outputs as 80 characters
scipen = 6, ## discourage R from displaying numbers in scientific notation
start.time= Sys.time()
)
pacman::p_load(c("emdi"))
install.packages('BiocManager')
library(emdi)
install.packages("checkmate")
pacman::p_load(c("emdi"))
pacman::p_load(emdi)
nam_selvars_list <- readRDS("data-raw/nam_selvars_list.RDS")
census_dt <- readRDS(here("data-raw/census_dt.RDS"))
census_dt <- readRDS("data-raw/census_dt.RDS")
survey_dt <- readRDS("data-raw/survey_dt.RDS")
census_dt
class(census_dt)
pacman::p_load(emdi, haven)
pacman::p_load(haven)
census_dt$const_code <- as.numeric(census_dt$const_code)
survey_dt$new_const_code <- as.numeric(survey_dt$new_const_code)
census_dt["wta_hh"] <- lapply(haven::zap_labels(census_dt["wta_hh"]) ,as.numeric)
nam_selvars_list  <- intersect(intersect(nam_selvars_list, names(survey_dt)), names(census_dt))
nam_selvars_list
as.formula(paste("lwel_PPP ~ ", paste(nam_selvars_list,
collapse= "+")))
as.data.frame(na.omit(census_dt[, c(nam_selvars_list,
"const_code")]))
str(as.data.frame(na.omit(census_dt[, c(nam_selvars_list,
"const_code")])))
str(as.data.frame(na.omit(survey_dt[, c("wel_PPP",
nam_selvars_list,
"new_const_code",
"hhweight")])))
survey_dt[,"wel_PPP"]
nam_selvars_list
survey_dt[,nam_selvars_list]
str(survey_dt[,nam_selvars_list])
survey_dt$new_const_code
survey_dt$hhweight
class(survey_dt)
colnames(survey)dt
colnames(survey_dt)
View(survey)dt
View(survey_dt)
survey_dt[!colnames(survey_dt) == NA]
survey_dt[,!is.na(colnames(survey_dt))]
colnames(survey_dt[,!is.na(colnames(survey_dt))])
survey_dt <- survey_dt[,!is.na(colnames(survey_dt))]
nam_model <- ebp(fixed = as.formula(paste("lwel_PPP ~ ", paste(nam_selvars_list,
collapse= "+"))),
pop_data = as.data.frame(na.omit(census_dt[, c(nam_selvars_list,
"const_code")])),
pop_domains = "const_code",
smp_data = as.data.frame(na.omit(survey_dt[, c("wel_PPP",
nam_selvars_list,
"new_const_code",
"hhweight")])),
smp_domains = "new_const_code",
transformation = "log",
threshold = 6249,
weights = "hhweight",
cpus = 1,
MSE = FALSE,
na.rm = TRUE)
pacman::p_load(emdi)
library(emdi)
install.packages("units")
library(emdi)
detach("package:emdi", unload = TRUE)
install.packages("emdi", dependencies = TRUE)
install.packages("s2")
pacman::p_load(emdi)
nam_model <- ebp(fixed = as.formula(paste("lwel_PPP ~ ", paste(nam_selvars_list,
collapse= "+"))),
pop_data = as.data.frame(na.omit(census_dt[, c(nam_selvars_list,
"const_code")])),
pop_domains = "const_code",
smp_data = as.data.frame(na.omit(survey_dt[, c("wel_PPP",
nam_selvars_list,
"new_const_code",
"hhweight")])),
smp_domains = "new_const_code",
transformation = "log",
threshold = 6249,
weights = "hhweight",
cpus = 1,
MSE = FALSE,
na.rm = TRUE)
as.data.frame(na.omit(survey_dt[, c("wel_PPP",
nam_selvars_list,
"new_const_code",
"hhweight")]))
